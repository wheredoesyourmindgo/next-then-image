{"version":3,"file":"index.umd.js","sources":["../src/util.ts"],"sourcesContent":["import sharp from \"sharp\";\n\nconst getLqip = async (url: string): Promise<string> => {\n  try {\n    const imageRes = await fetch(`${url}`);\n    const blob = await imageRes.blob();\n    const mimeType = blob.type;\n    const arrayBuffer = await blob.arrayBuffer();\n    const lqipSrc = await transform(arrayBuffer, mimeType);\n    return lqipSrc;\n  } catch (e) {\n    console.log(\"Failed to fetch base64 image\", url);\n    throw e;\n  }\n};\n\nconst getLqips = async (urls: Array<string>) => {\n  const lqips = await sequenceArray<string, string | null>(\n    urls,\n    async (url) => {\n      try {\n        const b64 = await getLqip(url);\n        // return {\n        //   lqip: b64,\n        //   src: url,\n        // };\n        return b64;\n      } catch (e) {\n        return null;\n      }\n    }\n  );\n  return lqips;\n\n  // const reduced = lqips.reduce((prev, curr) => {\n  //   const {src, lqip} = curr;\n  //   return {\n  //     ...prev,\n  //     [src]: lqip,\n  //   };\n  // });\n\n  // return reduced;\n};\n\nasync function sequenceArray<T, U = T>(\n  array: T[],\n  fn: (args: T) => Promise<U>\n) {\n  const results = [];\n  for (let i = 0; i < array.length; i++) {\n    const r = await fn(array[i]);\n    results.push(r);\n  }\n  return results;\n}\n\nfunction toBase64(buffer: Buffer, mimeType: string) {\n  return `data:${mimeType};base64,${buffer.toString(\"base64\")}`;\n}\n\nasync function transform(ab: ArrayBuffer, mimeType: string) {\n  return new Promise<string>((resolve, reject) => {\n    const buffer = Buffer.from(ab);\n    sharp(buffer)\n      .normalise()\n      .modulate({\n        saturation: 1.2,\n        brightness: 1,\n      })\n      .removeAlpha()\n      .resize(30, 30, { fit: \"inside\" })\n      .jpeg()\n      .toBuffer((err, buffer) => {\n        if (err) return reject(err);\n        resolve(toBase64(buffer, mimeType));\n      });\n  });\n}\n\nexport { getLqip, getLqips };\n"],"names":["state","value","_settle","transform","ab","mimeType","Promise","resolve","reject","buffer","Buffer","from","sharp","normalise","modulate","saturation","brightness","removeAlpha","resize","fit","jpeg","toBuffer","err","toBase64","onRejected","result","thenable","sequenceArray","array","fn","results","i","r","push","getLqip","url","fetch","imageRes","blob","type","arrayBuffer","e","console","log","getLqips","urls","toString"],"mappings":";;;;;;;;;;;;;;;;;;;;;;aAiDQ;kCACoB;;cAExBA,QAAQ;EACTA,UAAAA,eAAA;;;;;EAKDC,QAAAA,OAAA,gBAAuB,kBAAvB;;;;;wBAKc;aACZ,MAAMC,OAAO,KAAP,KAAA,MAAA,OAAA;;;;;;;;;;;;;;MAHKC,qBAAAA,UAAUC,IAAiBC;;EACxC,2BAAO,IAAIC,OAAJ,CAAoB,UAACC,OAAD,EAAUC,MAAV;EACzB,UAAMC,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYP,EAAZ,CAAf;EACAQ,MAAAA,KAAK,CAACH,MAAD,CAAL,CACGI,SADH,GAEGC,QAFH,CAEY;EACRC,QAAAA,UAAU,EAAE,GADJ;EAERC,QAAAA,UAAU,EAAE;EAFJ,OAFZ,EAMGC,WANH,GAOGC,MAPH,CAOU,EAPV,EAOc,EAPd,EAOkB;EAAEC,QAAAA,GAAG,EAAE;EAAP,OAPlB,EAQGC,IARH,GASGC,QATH,CASY,UAACC,GAAD,EAAMb,MAAN;EACR,YAAIa,GAAJ,EAAS,OAAOd,MAAM,CAACc,GAAD,CAAb;EACTf,QAAAA,OAAO,CAACgB,QAAQ,CAACd,MAAD,EAASJ,QAAT,CAAT,CAAP;EACD,OAZH;EAaD,KAfM,CAAP;EAgBD;;;;;MA5EY;;;kDAE6BmB;UACtCC,MAAM;UACNzB;;;;;;;;sBAKQ;;EAET;;;;EAID,mBAAA;;;;;;;;;;;;;;EAaG;EAEH;EAEA,sBAAA,GAAA,GAAA;EACA;;;;;;;;;;WAyCI0B,yBAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MA/BSC,yBAAAA,cACbC,OACAC;;EAEA,QAAMC,OAAO,GAAG,EAAhB;;0BACoBF,iBAAXG,GAA8B;EAAA,6BACrBF,EAAE,CAACD,KAAK,CAACG,CAAD,CAAN,CADmB,iBAC/BC,CAD+B;EAErCF,QAAAA,OAAO,CAACG,IAAR,CAAaD,CAAb;EAFqC;EAGtC;;;EACD,aAAOF,OAAP;WAAOA;EACR;;;;;MArDKI,OAAO,YAAPA,OAAO,CAAUC,GAAV;EAAA;gDACP;EAAA,6BACqBC,KAAK,MAAID,GAAJ,CAD1B,iBACIE,QADJ;EAAA,+BAEiBA,QAAQ,CAACC,IAAT,EAFjB,iBAEIA,IAFJ;EAGF,cAAMjC,QAAQ,GAAGiC,IAAI,CAACC,IAAtB;EAHE,iCAIwBD,IAAI,CAACE,WAAL,EAJxB,iBAIIA,WAJJ;EAAA,mCAKoBrC,SAAS,CAACqC,WAAD,EAAcnC,QAAd,CAL7B;EAAA;EAAA;EAAA;EAOH,iBAAQoC,GAAG;EACVC,MAAAA,OAAO,CAACC,GAAR,CAAY,8BAAZ,EAA4CR,GAA5C;EACA,YAAMM,CAAN;EACD;EACF,GAZY;EAAA;EAAA;EAAA;;MAcPG,QAAQ,YAARA,QAAQ,CAAUC,IAAV;2BACQlB,aAAa,CAC/BkB,IAD+B,YAExBV,GAFwB;gDAGzB;EAAA,6BACgBD,OAAO,CAACC,GAAD,CADvB;EAGF;EACA;EACA;EAED,mBAAW;EACV,aAAO,IAAP;EACD;EACF,GAb8B;EAkBjC;EACA;EACA;EACA;EACA;EACA;EAEA;EACD;;EAcD,SAASZ,QAAT,CAAkBd,MAAlB,EAAkCJ,QAAlC;EACE,mBAAeA,QAAf,gBAAkCI,MAAM,CAACqC,QAAP,CAAgB,QAAhB,CAAlC;EACD;;;;;;;;;"}